#!/bin/bash

set -o errexit

if [ -d input ]
then
  # We are running the tests inside a Docker container
  inputDir=input
  outputDir=output
else
  # We are running the tests locally
  inputDir=Validation
  outputDir=/tmp/output
  mkdir -p $outputDir
fi

debug=false
#debug=true
#numOuterIterations=10
numOuterIterations=2
numInnerIterations=2

rm -rf $outputDir/*

$(dirname $0)/classification StrongSignal_Both montecarlo $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/1.log &
$(dirname $0)/classification NoSignal_Both montecarlo $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/2.log &
$(dirname $0)/classification StrongSignal_Both crossvalidation $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/3.log &
$(dirname $0)/classification NoSignal_Both crossvalidation $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/4.log &
wait

python $(dirname $0)/CheckLogFiles.py "$outputDir/*.log" 4
rm -f "$outputDir/*.log"
exit

$(dirname $0)/featureselection StrongSignal_Both montecarlo $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/1.log &
$(dirname $0)/featureselection NoSignal_Both montecarlo $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/2.log &
$(dirname $0)/featureselection StrongSignal_Both crossvalidation $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/3.log &
$(dirname $0)/featureselection NoSignal_Both crossvalidation $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/4.log &
wait

python $(dirname $0)/CheckLogFiles.py "$outputDir/*.log" 4
rm -f "$outputDir/*.log"

$(dirname $0)/nestedclassification StrongSignal_Both montecarlo $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/1.log &
$(dirname $0)/nestedclassification NoSignal_Both montecarlo $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/2.log &
$(dirname $0)/nestedclassification StrongSignal_Both crossvalidation $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/3.log &
$(dirname $0)/nestedclassification NoSignal_Both crossvalidation $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/4.log &
wait

python $(dirname $0)/CheckLogFiles.py "$outputDir/*.log" 4
rm -f "$outputDir/*.log"

$(dirname $0)/nestedboth StrongSignal_Both montecarlo $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/1.log &
$(dirname $0)/nestedboth NoSignal_Both montecarlo $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/2.log &
$(dirname $0)/nestedboth StrongSignal_Both crossvalidation $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/3.log &
$(dirname $0)/nestedboth NoSignal_Both crossvalidation $inputDir $outputDir $debug $numOuterIterations $numInnerIterations $outputDir/4.log &
wait

python $(dirname $0)/CheckLogFiles.py "$outputDir/*.log" 4
rm -f "$outputDir/*.log"

echo "\nAll tests passed!!!!"
